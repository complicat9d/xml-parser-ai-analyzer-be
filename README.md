# Сервис с парсером XML и AI-анализатором

Этот сервис предназначен для парсинга `.xml` файлов, содержащих данные о продажах товаров, а также интеграции с искусственным интеллектом (модель OpenAI GPT) для анализа продаж за заданную дату.

## Описание архитектуры

Сервис выполняет следующие ключевые функции:

- **Парсинг XML**: Сервис использует библиотеку `httpx` для загрузки XML файлов, содержащих данные о продажах, по заданной URL-ссылке. В отличие от `requests`, `httpx` быстрее и поддерживает синхронные вызовы по сравнению с `aiohttp`. Файлы получаются по заданному URL каждый день в 0:00 (UTC+0) с помощью Celery Beat.
  
- **Планирование и выполнение задач**: Сервис также позволяет принимать внешние запросы через API-эндпоинт, построенный на FastAPI. Эти запросы инициируют задачи, которые обрабатываются в пайплайне Celery. Каждая задача выполняется асинхронно с помощью метода Celery `.apply_async()`, что обеспечивает многозадачность и параллельную обработку данных.
  
- **Брокер задач**: Задачи Celery управляются через **Redis**, который используется как брокер сообщений. Это позволяет эффективно и надежно ставить задачи в очередь для выполнения.
  
- **База данных**: Для хранения распарсенных данных, информации о продажах и сгенерированных отчетов используется **PostgreSQL**. Поскольку Celery использует свои собственные методы для работы с асинхронными функциями (которые не совместимы с Python `asyncio`), взаимодействие с базой данных происходит через синхронный движок.
  
- **Интеграция с ИИ**: Для генерации отчетов используется модель **OpenAI ChatGPT-3.5**. ИИ анализирует распарсенные данные о продажах и генерирует детализированные отчеты с выводами, трендами и рекомендациями по улучшению продаж. Также производится кэширование запросов для экономии токенов API ключа и повышения производительности.
  
- **Мониторинг и управление задачами**: Для мониторинга выполнения задач и управления рабочими процессами Celery используется инструмент **Flower**.

### Требования к API-ключам
Для использования **Claude** (Anthropic) или **ChatGPT** (OpenAI) необходимо иметь API-ключ. Также важно, чтобы баланс на аккаунте был пополнен минимум на 5 долларов, чтобы запросы могли быть обработаны.

## Как запустить проект

Для настройки и запуска проекта требуется установить **Docker** и **Docker Compose**. После установки выполните следующие шаги:

1. **Сборка Docker образов**:  
   Для создания Docker образов используйте команду:
   ```bash
   docker compose -f docker-compose.yaml build
   ```

2. **Запуск контейнеров**:  
   Для запуска контейнеров в фоновом режиме выполните команду:
   ```bash
   docker compose -f docker-compose.yaml up -d
   ```

   _Если контейнер alembic не запускается, просто выполните команду `up` еще раз._

## Примеры отчетов

### Пример 1
* **Полученный промт**:

Проанализируй данные о продажах:
1. Общая выручка: 401600
2. Топ-3 товара по продажам: Product P, Product H, Product L
3. Распределение по категориям: {'Electronics': 140, 'Home Appliances': 120, 'Beauty': 120, 'Sports': 80, 'Books': 290}
Составь краткий аналитический отчет с выводами и рекомендациями.

* **Ответ LLM**:

Аналитический отчет по продажам
1. Общая выручка
Общая выручка составила 401 600. Это является основным ориентиром для анализа и оценки эффективности продаж.


2. Топ-3 товара по продажам
Product P
Product H
Product L
Продукты P, H и L — это лидеры по объему продаж, что говорит о их высокой востребованности среди покупателей. Важно отметить, что фокус на этих товарах может быть выгодным для дальнейших маркетинговых и операционных стратегий. Рекомендуется детальнее изучить их особенности (ценовую политику, маркетинговые акции) для выявления факторов успеха.


3. Распределение по категориям
Electronics (Электроника): 140
Home Appliances (Бытовая техника): 120
Beauty (Красота): 120
Sports (Спорт): 80
Books (Книги): 290
Из распределения видно, что категория Books (Книги) имеет наибольший объем продаж — 290 единиц. Эта категория явно лидирует по популярности среди покупателей.

   Категории Beauty и Home Appliances показывают одинаковые результаты (по 120 единиц), что указывает на сбалансированный интерес потребителей к товарам этих категорий.
   
   Сегмент Electronics (140 единиц) также востребован, но уступает по объему продаж категориям книг и бытовой техники.
   
   Категория Sports имеет наименьший объем продаж — 80 единиц, что может свидетельствовать о низкой популярности спортивных товаров в текущем периоде. Возможно, стоит пересмотреть маркетинговые стратегии для этой категории или проанализировать сезонные колебания спроса.


4. Выводы
Лидирующие товары: Продукты P, H и L требуют большего внимания для поддержания и увеличения их продаж. Возможно, стоит расширить ассортимент, связанный с этими товарами, или провести дополнительные рекламные кампании.

   Преобладание книг: Книги доминируют в продажах, что подтверждает их высокую популярность среди клиентов. Рекомендуется усилить предложение в этой категории, возможно, за счет внедрения новых изданий или книг в трендовых жанрах.
   
   Сбалансированность категорий: В целом, категории Beauty, Home Appliances и Electronics показывают неплохие результаты. Для поддержания или увеличения их объемов можно рассмотреть дополнительные акции, улучшение ассортимента и персонализированные предложения для клиентов.
   
   Низкие продажи в спортивной категории: Спортивные товары явно отстают от других категорий. Стоит пересмотреть маркетинговые кампании для привлечения внимания к этому сегменту, возможно, фокусируясь на сезонных акциях или спортивных событиях.


5. Рекомендации
Провести детальный анализ факторов успеха продуктов P, H и L и адаптировать маркетинговые стратегии для поддержания их популярности.
Увеличить ассортимент и рекламные усилия в категории Books, что является самой прибыльной.
Провести дополнительные исследования для понимания причин слабых продаж в категории Sports и улучшить их продвижение.
Рассмотреть внедрение акций или спецпредложений для стимулирования покупок в категории Electronics и Home Appliances.
Заключение: Данные о продажах показывают сильную позицию в категории Books и устойчивый спрос на другие товары. Для дальнейшего роста следует усилить фокус на ключевых продуктах и категориях с потенциалом роста, а также проанализировать слабые стороны в менее популярной категории Sports.

### Пример 2
* **Полученный промт**:

Проанализируй данные о продажах:
1. Общая выручка: 1509330
2. Топ-3 товара по продажам: Product AR, Product AQ, Product AF
3. Распределение по категориям: {'Sports': 520, 'Books': 600, 'Beauty': 600, 'Home Appliances': 860, 'Electronics': 350, 'Furniture': 490}
Составь краткий аналитический отчет с выводами и рекомендациями.

* **Ответ LLM**:

Аналитический отчет по данным о продажах
Общая выручка: 1,509,330

1. Топ-3 товара по продажам:
Product AR
Product AQ
Product AF
Эти товары являются основными источниками выручки, что свидетельствует о высокой востребованности определенных позиций в ассортименте. Возможно, стоит сосредоточить внимание на этих продуктах для дальнейшего увеличения продаж, например, через акции, улучшение маркетинга или расширение ассортимента на их основе.


2. Распределение по категориям:
Sports: 520
Books: 600
Beauty: 600
Home Appliances: 860
Electronics: 350
Furniture: 490
Данные показывают следующее распределение выручки по категориям:

   Наиболее прибыльная категория: Home Appliances (860), что указывает на высокий спрос на бытовую технику. Эта категория заслуживает особого внимания для дальнейших инвестиций и расширения ассортимента.
   Сравнительно высокие продажи также в категориях Books и Beauty (по 600), что предполагает стабильный интерес покупателей к товарам этих категорий.
   Низкий интерес к Electronics (350) и Furniture (490) относительно других категорий, что может сигнализировать о необходимости пересмотра ценовой политики, качества или маркетинга в этих сегментах.


3. Выводы и рекомендации:
   Углубленная работа с топовыми товарами: Продукты AR, AQ и AF привлекают основной объем продаж. Рекомендуется провести анализ их характеристик и целевой аудитории, а также активнее продвигать эти товары через маркетинговые кампании и специальные предложения.
   
   Увеличение ассортимента в высокодоходных категориях: Наибольший интерес вызывает категория бытовой техники (Home Appliances). Возможно, стоит рассмотреть добавление новых моделей или уникальных товаров в эту категорию.
   
   Коррекция стратегии для категории Electronics: Поскольку эта категория приносит меньше выручки, важно проанализировать причины. Возможно, стоит пересмотреть ассортимент, улучшить представление продуктов или предложить скидки и акции, чтобы стимулировать спрос.
   
   Акции и продвижение в менее прибыльных категориях: Furniture и Sports могут требовать дополнительного внимания в части маркетинга, чтобы увеличить продажи. Например, можно организовать распродажи или предложить сезонные скидки, чтобы повысить интерес к этим товарам.
   
   Заключение:
   Анализ данных показывает, что определенные категории товаров и продукты в них демонстрируют более высокий спрос. Для увеличения общей выручки необходимо продолжить развитие успешных категорий и товаров, а также скорректировать стратегии продаж в менее прибыльных сегментах.
